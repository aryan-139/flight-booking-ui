<app-navbar></app-navbar>

<div class="bg-gray-50">
    <div class="min-h-screen bg-gray-50 py-8 mt-12 relative z-10 ">
        <div
            class="pt-20 absolute top-0 left-0 w-full h-[48vh] bg-gradient-to-b from-[#07111d] via-[#0a2342] to-[#123c6a]">
            <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-4 gap-6 px-4 sm:px-6 lg:px-8 ">
                <!-- Loading Spinner -->

                @if (isLoading) {
                <!-- LEFT: Flight Details + Cancellation (Loading State) -->
                <div class="lg:col-span-3">
                    <!-- Flight Details Skeleton -->
                    <div class="bg-white shadow-md rounded-lg border border-gray-200 overflow-hidden">
                        <div class="flex">
                            <div class="w-1 bg-gray-200 animate-pulse"></div>
                            <div class="flex-1 p-6">
                                <!-- Top row skeleton -->
                                <div class="flex items-start justify-between mb-4">
                                    <div class="space-y-3">
                                        <div class="h-8 bg-gray-200 rounded w-64 animate-pulse"></div>
                                        <div class="flex gap-3">
                                            <div class="h-6 bg-gray-200 rounded w-24 animate-pulse"></div>
                                            <div class="h-6 bg-gray-200 rounded w-32 animate-pulse"></div>
                                        </div>
                                        <div class="h-5 bg-gray-200 rounded w-48 animate-pulse"></div>
                                    </div>
                                    <div class="space-y-2">
                                        <div class="h-6 bg-gray-200 rounded w-32 animate-pulse"></div>
                                        <div class="h-4 bg-gray-200 rounded w-20 animate-pulse"></div>
                                        <div class="h-4 bg-gray-200 rounded w-24 animate-pulse"></div>
                                    </div>
                                </div>

                                <!-- Timing panel skeleton -->
                                <div class="bg-gray-50 border rounded p-4">
                                    <div class="flex justify-between items-center">
                                        <div class="space-y-2">
                                            <div class="h-6 bg-gray-200 rounded w-16 animate-pulse"></div>
                                            <div class="h-4 bg-gray-200 rounded w-24 animate-pulse"></div>
                                            <div class="h-4 bg-gray-200 rounded w-20 animate-pulse"></div>
                                            <div class="h-6 bg-gray-200 rounded w-16 animate-pulse"></div>
                                            <div class="h-4 bg-gray-200 rounded w-24 animate-pulse"></div>
                                        </div>
                                        <div class="h-10 bg-gray-200 rounded w-32 animate-pulse"></div>
                                    </div>

                                    <hr class="my-3 border-gray-200" />

                                    <!-- Baggage skeleton -->
                                    <div class="flex gap-6">
                                        <div class="flex items-center gap-2">
                                            <div class="w-6 h-6 bg-gray-200 rounded animate-pulse"></div>
                                            <div class="h-4 bg-gray-200 rounded w-32 animate-pulse"></div>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <div class="w-6 h-6 bg-gray-200 rounded animate-pulse"></div>
                                            <div class="h-4 bg-gray-200 rounded w-36 animate-pulse"></div>
                                        </div>
                                    </div>

                                    <div class="mt-4 h-12 bg-gray-200 rounded animate-pulse"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cancellation Policy Skeleton -->
                    <div class="bg-purple-50 shadow-md p-6 rounded-lg mt-4">
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <div class="h-6 bg-gray-200 rounded w-48 animate-pulse"></div>
                                <div class="h-4 bg-gray-200 rounded w-20 animate-pulse"></div>
                            </div>
                            <div class="flex justify-between">
                                <div class="h-4 bg-gray-200 rounded w-16 animate-pulse"></div>
                                <div class="h-4 bg-gray-200 rounded w-16 animate-pulse"></div>
                                <div class="h-4 bg-gray-200 rounded w-16 animate-pulse"></div>
                            </div>
                            <div class="h-2 bg-gray-200 rounded-full animate-pulse"></div>
                            <div class="flex justify-between">
                                <div class="h-4 bg-gray-200 rounded w-8 animate-pulse"></div>
                                <div class="h-4 bg-gray-200 rounded w-12 animate-pulse"></div>
                                <div class="h-4 bg-gray-200 rounded w-12 animate-pulse"></div>
                                <div class="h-4 bg-gray-200 rounded w-12 animate-pulse"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- RIGHT: Fare Summary (Loading State) -->
                <div class="lg:col-span-1">
                    <div class="bg-white shadow-md p-6 h-fit rounded-lg">
                        <div class="space-y-4">
                            <div class="h-8 bg-gray-200 rounded w-32 animate-pulse"></div>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <div class="h-4 bg-gray-200 rounded w-20 animate-pulse"></div>
                                    <div class="h-4 bg-gray-200 rounded w-16 animate-pulse"></div>
                                </div>
                                <div class="flex justify-between">
                                    <div class="h-4 bg-gray-200 rounded w-24 animate-pulse"></div>
                                    <div class="h-4 bg-gray-200 rounded w-16 animate-pulse"></div>
                                </div>
                                <div class="flex justify-between">
                                    <div class="h-4 bg-gray-200 rounded w-28 animate-pulse"></div>
                                    <div class="h-4 bg-gray-200 rounded w-16 animate-pulse"></div>
                                </div>
                                <hr>
                                <div class="flex justify-between">
                                    <div class="h-6 bg-gray-200 rounded w-24 animate-pulse"></div>
                                    <div class="h-6 bg-gray-200 rounded w-20 animate-pulse"></div>
                                </div>
                            </div>
                            <div class="h-24 bg-gray-200 rounded animate-pulse"></div>
                        </div>
                    </div>
                </div>
                } @else{
                <!-- LEFT: Flight Details + Cancellation (Content) -->
                <div *ngIf="!isLoading" class="lg:col-span-3">

                    <!-- Flight Details Card -->
                    <div class="bg-white shadow-md rounded-lg border border-gray-200 overflow-hidden"
                        *ngIf="selectedFlight">
                        <div class="flex">
                            <!-- thin left teal accent -->
                            <div class="w-1 bg-[#2aa88f]"></div>

                            <div class="flex-1 p-6">
                                <!-- Top row: route / date / meta -->
                                <div class="flex items-start justify-between">
                                    <div class="pr-6">
                                        <p class="text-2xl font-extrabold tracking-tight">
                                            {{ getCityNameFromCode(selectedFlight.data.origin) }} ‚Üí {{
                                            getCityNameFromCode(selectedFlight.data.destination) }}
                                        </p>

                                        <div class="mt-3 flex items-center gap-3">
                                            <!-- date badge -->
                                            <span
                                                class="bg-[#FAE9C8] text-sm text-gray-800 px-3 py-1 rounded-md font-medium">
                                                {{selectedFlight.data.date ? (selectedFlight.data.date | date:'EEEE,
                                                MMMd') : '' }}
                                            </span>

                                            <!-- stop / duration -->
                                            <span class="text-sm text-gray-600">
                                                {{ selectedFlight.data.stops ? (selectedFlight.data.stops + ' Stop' +
                                                (selectedFlight.data.stops>1? 's':'')) : 'Non Stop' }}
                                                ¬∑
                                                {{ formatDuration(selectedFlight.data.duration) }}
                                            </span>
                                        </div>

                                        <!-- airline + flight number -->
                                        <div class="mt-3 flex items-center gap-3">
                                            <!-- optional logo if present -->
                                            <img *ngIf="selectedFlight.data.airline_logo"
                                                [src]="selectedFlight.data.airline_logo"
                                                alt="{{ selectedFlight.data.airline }}"
                                                class="w-8 h-8 object-contain" />
                                            <span class="text-base font-semibold">
                                                {{ selectedFlight.data.airline }}
                                            </span>
                                            <span class="text-sm text-gray-500"> {{ selectedFlight.data.flight_number }}
                                            </span>
                                        </div>
                                    </div>

                                    <div class="text-right flex flex-col items-end gap-2">
                                        <span class="bg-[#6FCFB0] text-white px-3 py-1 text-xs rounded-md">
                                            CANCELLATION FEES APPLY
                                        </span>
                                        <a class="text-blue-600 text-sm" href="#" (click)="$event.preventDefault()">View
                                            Fare Rules</a>
                                        <div class="text-sm text-gray-700">
                                            {{ selectedFlight.data.cabin_family || 'Economy' }} &nbsp;
                                            <span class="text-blue-600 font-semibold">&gt; {{
                                                selectedFlight.data.cabin_class }}</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- main timing panel -->
                                <div class="mt-4 bg-gray-50 border rounded p-4">
                                    <div class="max-w-2xl w-full font-sans">
                                        <div
                                            class="flex justify-between items-start bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                                            <div class="flex items-start gap-3">
                                                <div class="flex flex-col items-center h-full mt-1">

                                                    <div class="flex-1 border-l-2 border-dashed border-gray-300 my-1">
                                                    </div>
                                                </div>
                                                <div>
                                                    <span class="font-bold text-sm">
                                                        {{ formatTime(selectedFlight.data.departure_time) }}
                                                    </span>
                                                    <span class="text-gray-400 text-lg">‚óã</span>
                                                    <span class="font-bold">
                                                        {{getCityNameFromCode(selectedFlight.data.origin)}}
                                                    </span>
                                                    <span class="text-gray-600">
                                                        . {{getAirportNameFromCode(selectedFlight.data.origin)}}
                                                    </span>

                                                    <p class="text-sm text-gray-500 m-2">
                                                        {{formatDuration(selectedFlight.data.duration)}}
                                                    </p>
                                                    <span class="font-bold text-sm">
                                                        {{formatTime(selectedFlight.data.arrival_time)}}
                                                    </span>
                                                    <span class="text-gray-400 text-lg">‚óã</span>
                                                    <span class="font-bold">
                                                        {{getCityNameFromCode(selectedFlight.data.destination)}}
                                                    </span>
                                                    <span class="text-gray-600">
                                                        . {{getAirportNameFromCode(selectedFlight.data.destination)}}
                                                    </span>
                                                </div>
                                            </div>

                                            <div
                                                class="flex items-center gap-3 border border-blue-400 rounded-md px-3 py-1">
                                                <span class="text-gray-700 text-lg">üç¥</span>
                                                <span class="text-gray-700 text-lg">‚úàÔ∏è</span>
                                                <span class="text-gray-700 text-lg">üß≥</span>
                                                <span class="text-gray-700 text-lg">üí∫</span>
                                            </div>
                                        </div>
                                    </div>


                                    <hr class="my-3 border-gray-200" />

                                    <!-- baggage row -->
                                    <div class="flex flex-wrap items-center gap-6 text-sm">
                                        <div class="flex items-center gap-2">
                                            <span class="text-2xl">üß≥</span>
                                            <div>
                                                <span class="text-sm font-medium">Cabin Baggage:</span>
                                                <span class="text-sm text-gray-600"> {{
                                                    selectedFlight.data.cabin_baggage || (7 * passengers) + ' Kgs (' +
                                                    passengers + ' pieces)' }} </span>
                                            </div>
                                        </div>

                                        <div class="flex items-center gap-2">
                                            <span class="text-2xl">üíº</span>
                                            <div>
                                                <span class="text-sm font-medium">Check-In Baggage:</span>
                                                <span class="text-sm text-gray-600"> {{
                                                    selectedFlight.data.checkin_baggage || (15 * passengers) + ' Kgs ('
                                                    + passengers + ' pieces)' }} </span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- bottom callout -->
                                    <div
                                        class="mt-4 p-3 rounded border bg-blue-50 flex items-center justify-between text-xs">
                                        <span>Got excess baggage? Don‚Äôt stress, buy extra check-in baggage allowance for
                                            {{ getCityNameFromCode(selectedFlight.data.origin) }}-{{
                                            getCityNameFromCode(selectedFlight.data.destination) }} at fab rates!</span>
                                        <a href="#" class="text-blue-600 font-medium"
                                            (click)="$event.preventDefault()">ADD BAGGAGE</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>



                    <div class="bg-purple-50 shadow-md p-6 mt-4">
                        <!-- Header -->
                        <div class="flex justify-between items-center mb-4">
                            <span class="font-semibold text-md mb-4">Cancellation & Date Change Policy</span>
                            <span class="text-md text-blue-400 mb-4">View Policy</span>
                        </div>

                        <!-- Timeline Values -->
                        <div class="flex items-center justify-between mb-2 text-sm font-semibold">
                            <span>‚Çπ {{ selectedFlight?.data?.price * 0.2 }}</span>
                            <span>‚Çπ {{selectedFlight?.data?.price * 0.5}}</span>
                            <span>‚Çπ {{ selectedFlight?.data?.price + calculateSurcharges(selectedFlight?.data?.price +
                                selectedFlight?.data?.dynamic_price) }}</span>
                        </div>

                        <!-- Gradient Timeline -->
                        <div class="h-2 w-full rounded-full overflow-hidden mb-2">
                            <div class="h-full w-full rounded-full"
                                style="background: linear-gradient(to right, #22c55e, #eab308, #ef4444);">
                            </div>
                        </div>

                        <!-- Timeline Labels -->
                        <div class="flex items-center justify-between text-sm">
                            <span class="font-semibold">Now</span>
                            <span>
                                <span class="font-semibold">21 Oct</span><br>
                                <span class="text-gray-500">20:00</span>
                            </span>
                            <span>
                                <span class="font-semibold">22 Oct</span><br>
                                <span class="text-gray-500">18:00</span>
                            </span>
                            <span>
                                <span class="font-semibold">22 Oct</span><br>
                                <span class="text-gray-500">20:00</span>
                            </span>
                        </div>

                        <div class="mt-4">
                            <p class="p-2 bg-orange-100 text-sm">The timeline mentioned above is in <b>Indian Standard
                                    Time (IST)</b></p>
                        </div>


                    </div>

                    <!--Passenger Details Expansion Panel-->
                    <div class="bg-white shadow-md rounded-lg border border-gray-200 overflow-hidden mt-6">
                        <!-- Panel Header -->
                        <div class="p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition-colors"
                            (click)="togglePassengerPanel()">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <p class="text-lg font-semibold text-gray-900">Passenger Details</p>
                                    <span *ngIf="selectedPassengers.length > 0"
                                        class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full font-medium">
                                        {{ selectedPassengers.length }} selected
                                    </span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <!-- Loading indicator in header -->
                                    <div *ngIf="isLoadingPassengers"
                                        class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"></div>
                                    <!-- Expand/Collapse Icon -->
                                    <svg class="w-5 h-5 text-gray-500 transition-transform duration-200"
                                        [class.rotate-180]="isPassengerPanelExpanded" fill="none" viewBox="0 0 24 24"
                                        stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7" />
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <!-- Panel Content -->
                        <div class="transition-all duration-300 ease-in-out" [class.max-h-0]="!isPassengerPanelExpanded"
                            [class.max-h-[2000px]]="isPassengerPanelExpanded"
                            [class.overflow-hidden]="!isPassengerPanelExpanded">
                            <div class="p-4" *ngIf="isPassengerPanelExpanded">

                                <!-- Existing Passengers Section -->
                                <div class="mb-6">
                                    <p class="text-md font-thin text-gray-800 mb-2">Select from Saved Passengers</p>

                                    <!-- Loading State -->
                                    <div *ngIf="isLoadingPassengers" class="flex justify-center py-8">
                                        <p class="text-gray-600">Loading passengers...</p>
                                    </div>

                                    <!-- No Passengers Message -->
                                    <div *ngIf="!isLoadingPassengers && existingPassengers.length === 0"
                                        class="text-center py-8">
                                        <div class="text-gray-500 mb-2">
                                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24"
                                                stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                            </svg>
                                        </div>
                                        <p class="text-gray-600">No saved passengers found. Add a new passenger below.
                                        </p>
                                    </div>

                                    <!-- Passenger List -->
                                    <div *ngIf="!isLoadingPassengers && existingPassengers.length > 0"
                                        class="space-y-0.5">
                                        <div *ngFor="let passenger of existingPassengers"
                                            (click)="togglePassengerSelection(passenger)"
                                            class="flex items-center p-1 border rounded-md cursor-pointer transition-all hover:shadow-sm"
                                            [class.bg-blue-50]="isPassengerSelected(passenger)"
                                            [class.border-blue-300]="isPassengerSelected(passenger)"
                                            [class.bg-white]="!isPassengerSelected(passenger)"
                                            [class.border-gray-200]="!isPassengerSelected(passenger)">

                                            <!-- Checkbox -->
                                            <div class="flex-shrink-0 mr-2">
                                                <div class="w-4 h-4 border rounded flex items-center justify-center"
                                                    [class.bg-blue-600]="isPassengerSelected(passenger)"
                                                    [class.border-blue-600]="isPassengerSelected(passenger)"
                                                    [class.border-gray-300]="!isPassengerSelected(passenger)">
                                                    <svg *ngIf="isPassengerSelected(passenger)"
                                                        class="w-2.5 h-2.5 text-white" fill="currentColor"
                                                        viewBox="0 0 20 20">
                                                        <path fill-rule="evenodd"
                                                            d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                                            clip-rule="evenodd"></path>
                                                    </svg>
                                                </div>
                                            </div>

                                            <!-- Passenger Info -->
                                            <div class="flex-1">
                                                <div class="flex items-center justify-between">
                                                    <div>
                                                        <!-- Passenger Name -->
                                                        <h5 class="text-base font-semibold text-gray-900">
                                                            {{ passenger.name }}
                                                        </h5>

                                                        <!-- Other details in one line -->
                                                        <p class="text-xs text-gray-500 mt-0.5 truncate">
                                                            {{ passenger.email_id }} ‚Ä¢ {{ passenger.phone_number }} ‚Ä¢
                                                            DOB: {{ passenger.dob | date:'MMM dd, yyyy' }}
                                                        </p>
                                                    </div>

                                                    <!-- Passenger Type Badge -->
                                                    <span class="px-2 py-0.5 text-md font-thin rounded-full"
                                                        [class]="getPassengerTypeColor(passenger.type)">
                                                        {{ passenger.type | titlecase }}
                                                    </span>
                                                </div>
                                            </div>


                                        </div>
                                    </div>

                                </div>

                                <!-- Add New Passenger Section -->
                                <div class="border-t pt-6">
                                    <div class="flex items-center justify-between mb-4">
                                        <h4 class="text-lg font-semibold text-gray-800">Add New Passenger</h4>
                                        <button *ngIf="!showAddPassengerForm" (click)="showAddPassenger()" class="px-5 py-2.5 rounded-full text-white font-medium 
               bg-gradient-to-r from-green-500 to-emerald-600
               shadow-md hover:from-green-600 hover:to-emerald-700 
               transition-all duration-300 ease-in-out">
                                            + Add New
                                        </button>

                                    </div>

                                    <!-- Add Passenger Form -->
                                    <div *ngIf="showAddPassengerForm" class="bg-gray-50 p-4 rounded-lg">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <!-- Name -->
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Full
                                                    Name</label>
                                                <input type="text" [(ngModel)]="newPassenger.name"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                    placeholder="Enter full name">
                                            </div>

                                            <!-- Date of Birth -->
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Date of
                                                    Birth</label>
                                                <input type="date" [(ngModel)]="newPassenger.dob"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            </div>

                                            <!-- Passenger Type -->
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Passenger
                                                    Type</label>
                                                <select [(ngModel)]="newPassenger.type"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                    <option value="adult">Adult</option>
                                                    <option value="child">Child</option>
                                                    <option value="infant">Infant</option>
                                                </select>
                                            </div>

                                            <!-- Email -->
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Email
                                                    (Optional)</label>
                                                <input type="email" [(ngModel)]="newPassenger.email_id"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                    placeholder="Enter email address">
                                            </div>

                                            <!-- Phone Number -->
                                            <div class="md:col-span-2">
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number
                                                    (Optional)</label>
                                                <div class="flex">
                                                    <select [(ngModel)]="newPassenger.country_code"
                                                        class="px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                        <option value="+91">+91</option>
                                                        <option value="+1">+1</option>
                                                        <option value="+44">+44</option>
                                                    </select>
                                                    <input type="tel" [(ngModel)]="newPassenger.phone_number"
                                                        class="flex-1 px-3 py-2 border border-gray-300 rounded-r-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                        placeholder="Enter phone number">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Form Actions -->
                                        <div class="flex justify-end space-x-3 mt-4">
                                            <button (click)="resetNewPassengerForm()"
                                                class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                                Cancel
                                            </button>
                                            <button (click)="addNewPassenger()"
                                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                                Add Passenger
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Selected Passengers Summary -->
                                <div *ngIf="selectedPassengers.length > 0" class="mt-6 p-4 bg-blue-50 rounded-lg">
                                    <h5 class="font-semibold text-blue-900 mb-2">Selected Passengers ({{
                                        selectedPassengers.length }})</h5>
                                    <div class="flex flex-wrap gap-2">
                                        <span *ngFor="let passenger of selectedPassengers"
                                            class="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full">
                                            {{ passenger.name }} ({{ passenger.type }})
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Seat Selection Section -->
                    <div class="mt-6 bg-blue-50 p-4 rounded-lg">
                        <div class="mb-4">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Seat Selection</h3>
                            <p class="text-sm text-gray-600">
                                Select seats for {{ selectedPassengers.length }} passenger{{ selectedPassengers.length
                                !== 1 ? 's' : '' }}
                            </p>
                        </div>

                        <!-- Show seat selection only if passengers are selected -->
                        <div *ngIf="selectedPassengers.length > 0; else noPassengersSelected">
                            <app-seat-selection [totalSeats]="totalSeats" [passengerCount]="selectedPassengers.length"
                                (seatsSelected)="onSeatsSelected($event)">
                            </app-seat-selection>
                        </div>

                        <!-- No passengers selected message -->
                        <ng-template #noPassengersSelected>
                            <div class="text-center py-8">
                                <div class="text-gray-400 mb-2">
                                    <svg class="mx-auto h-12 w-12" fill="none" viewBox="0 0 24 24"
                                        stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                    </svg>
                                </div>
                                <p class="text-gray-600 font-medium">Please select passengers first</p>
                                <p class="text-sm text-gray-500 mt-1">Choose passengers from the list above to proceed
                                    with seat selection</p>
                            </div>
                        </ng-template>
                    </div>

                </div>


                <!-- RIGHT: Fare Summary (Content) -->
                <div *ngIf="!isLoading" class="lg:col-span-1">
                    <div class="bg-white shadow-md p-6 h-fit rounded-lg" *ngIf="selectedFlight">
                        <h3 class="text-2xl font-extrabold mb-4">Fare Summary</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>Base Fare</span>
                                <span>‚Çπ {{ selectedFlight?.data?.price || 6900 }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Dynamic Pricing</span>
                                <span>‚Çπ {{ selectedFlight?.data?.dynamic_price || 0}}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Taxes and Surcharges</span>
                                <span>‚Çπ {{ calculateSurcharges(selectedFlight?.data?.price +
                                    selectedFlight?.data?.dynamic_price) }}</span>
                            </div>
                            <!-- Seat Selection Cost -->
                            <div *ngIf="seatSelectionTotal > 0" class="flex justify-between">
                                <span>Seat Selection</span>
                                <span>‚Çπ {{ seatSelectionTotal }}</span>
                            </div>
                            <hr>
                            <div class="flex justify-between font-bold text-lg">
                                <span>Total Amount</span>
                                <span>‚Çπ {{ getTotalAmount() }}</span>
                            </div>
                        </div>

                        <!-- Coupons -->
                        <div class="mt-6 p-4 bg-yellow-50 border rounded">
                            <h4 class="font-medium mb-2">Coupons and Offers</h4>
                            <input type="text" placeholder="Enter coupon code"
                                class="w-full border p-2 rounded text-sm">
                            <a href="#" class="block text-blue-600 mt-2 text-sm">VIEW ALL COUPONS</a>
                        </div>
                    </div>
                </div>
                }



            </div>
        </div>

    </div>